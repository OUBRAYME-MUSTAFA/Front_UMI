
<main id="main" class="main">
  <div class="pagetitle row">
    <div class="col-md-6">
      <legend>Liste des Laboratoires </legend><hr>
    </div>
      <div [hidden]='hideFormError' class="alert alert-danger col-md-4" role="alert">
        {{ formMessage }}
      </div>

      <div [hidden]='hideFormOk' class="alert alert-success col-md-4" role="alert">
        {{ formMessage }}
      </div>
      <div class="col-md-6 text-end">
      <button (click)="change(false)" type="button" class="btn-dark btn-sm p-1" data-bs-toggle="modal" data-bs-target="#ajouterLabo">
        <i class="fa fa-plus"></i>
        Add Labo
      </button>
     
      </div>
      <div id="custom-search" class="search">
        <div class="search float-end">
          Search: <input size="22" type="text" placeholder="Search.." [(ngModel)]="search">
        
        </div>
      </div>
      <!--form #f="ngForm" (ngSubmit)="onChercher(Value)">
        <div class="form-group">
          <input [(ngModel)]="value" type="text" name="keyword" placeholder="mot clé"  ngModel>
          <button type="submit" class="btn btn-primary m-lg-1">search</button>
        </div>
      </form-->
      <br>
      <br>
      <section class="section">
        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body">
                <table class="table table-striped" *ngIf="axes">
        <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Acronyme</th>
          <th scope="col">Intitulé</th>
          <th scope="col">Responsable</th>
          <th scope="col">Members</th>
          <th scope="col">Domains de recherche</th>
          <th scope="col">Les Equipes</th>
          <th scope="col">Action</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let labo1 of labos  | filter:search;">
          <th scope="row">{{labo1.id}}</th>
          <td>{{labo1.acro_labo}}</td>
          <td>{{labo1.intitule}}</td>
          <td>Pr {{labo1.responsable?.nom+" "+labo1.responsable?.prenom}}</td>
          <td><dd *ngFor="let me of toArray(labo1.member)">-Pr {{me.nom+" "+me.prenom}}</dd></td>
          <td><dd *ngFor="let axe of toArray(labo1.axes)">- {{axe.name}}</dd></td>
          <td><dd *ngFor="let equipe of toArray(labo1.equipes_object)">- {{equipe.acro_equipe}}</dd></td>
    
          <td>
            <div class="d-grid gap-2 d-md-block">
              <button (click)="editLabo(labo1)"       type="button"  class="border-0 text-primary fa-lg bg-transparent"  data-bs-toggle="modal" data-bs-target="#updateLabo"><i class="fa fa-pencil-square-o"></i></button>
              <button (click)="deleteLabo(labo1.id)"  type="button"  class="border-0 text-danger  fa-lg bg-transparent" >                                                     <i class="fa fa-trash-o"></i></button>&nbsp;
              <!--button (click)="editLabo(labo1)" (click)="changeEq(true)"  type="button" class="btn btn-primary float-end btn-lg mt-2" data-bs-toggle="modal" data-bs-target="#ajouterEquipe"> <i  class="bi bi-diagram-2-fill"> addEquipes</i></button-->
              <button (click)="editLabo(labo1)" (click)="changeAx(true)"  type="button" class="border-0 fa-lg text-warning bg-transparent" data-bs-toggle="modal" data-bs-target="#ajouterEquipe" > <i data-bs-toggle="tooltip" data-bs-placement="top" title="Effectuer Axes" class="bi bi-diagram-3 " ></i></button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
</div>
</section>
    </div>
  </main>

  <div class="modal fade" id="ajouterLabo" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">

          <!-- <h5 *ngIf="editForm" class="modal-title fw-bold">Modifier Labo</h5> -->

          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true"><i class="bi bi-x-lg"></i></span>
          </button>
        </div>
        <div class="modal-body">

          <form  #labo_f="ngForm" >
         
            
            <div class="mb-3">
              <label class="form-label">Acronyme</label>
              <input [(ngModel)]="myLabo.acro_labo"  [ngModelOptions]="{standalone: true}"  ngModel #acro_labo="ngModel" minlength="4" [appCheckExist]="[labos,'acro_labo']" type="text" class="form-control" name="titre" placeholder="Acronyme " required>
              <div class="invalid-feedback">
                <div   *ngIf="!acro_labo.valid && (acro_labo.touched || acro_labo.dirty)">
                  <div *ngIf="acro_labo.errors?.['required']">this champ is required</div>
                  <div *ngIf="acro_labo.errors?.['minlength']">the minimum length should be {{acro_labo.errors?.['minlength'].requiredLength}}</div>
                  <div *ngIf="acro_labo.errors?.['forbiddenName']">
                    {{myLabo.acro_labo}} déja existe.
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Intitulé</label>
                <input [(ngModel)]="myLabo.intitule" [ngModelOptions]="{standalone: true}"  type="text" class="form-control" name="titre1" placeholder="Intitulé" required
                ngModel #intitule="ngModel" minlength="4" [appCheckExist]="[labos,'intitule']">
                <div class="invalid-feedback">
                  <div  *ngIf="!intitule.valid && (intitule.touched || intitule.dirty)">
                    <div *ngIf="intitule.errors?.['required']">this champ is required</div>
                    <div *ngIf="intitule.errors?.['minlength']">the minimum length should be {{intitule.errors?.['minlength'].requiredLength}}</div>
                    <div *ngIf="intitule.errors?.['forbiddenName']">
                      {{myLabo.intitule}} déja existe.
                    </div>
                  </div>
                </div>
            </div>

            <div class="mb-3">
              <label for="responsable">Responsable</label>
              
              <select #responsable="ngModel" 
              class="form-control" id="responsableFiliere32" name="responsable" name="libele" [(ngModel)]="myLabo.responsable" [ngModelOptions]="{standalone: true}" placeholder="Responsable " required>
                  <option [ngValue]="p" *ngFor="let p of chercheurs;let index=index">{{p.nom+" "+p.prenom}}</option>
                </select>
                <div class="invalid-feedback">
                  <div  *ngIf="!responsable.valid && (responsable.touched || responsable.dirty)">
                    <div *ngIf="responsable.errors?.['required']">this champ is required</div>
                   
                  </div>
                </div>
          </div>
            <!--div class="mb-3">
              <label for="responsable">Responsable</label>
              
              <select #responsable="ngModel" 
              class="form-control" id="responsableFiliere54356346" name="responsable" name="libele" [(ngModel)]="myLabo.responsable" [ngModelOptions]="{standalone: true}" placeholder="Responsable " required>
                  <option [ngValue]="p" *ngFor="let p of chercheurs;let index=index">{{p.nom+" "+p.prenom}}</option>
                </select>
                <div class="invalid-feedback">
                  <div  *ngIf="!responsable.valid && (responsable.touched || responsable.dirty)">
                    <div *ngIf="responsable.errors?.['required']">this champ is required</div>
                   
                  </div>
                </div>
          </div-->


            <div class="col-md-8 mb-3">
                <label for="validationDefault02">Listes des Axes</label>
                <ng-multiselect-dropdown
                  [settings]="dropdownSettings_axe"
                  [data]="axes"
                  [(ngModel)]="myLabo.axes" [ngModelOptions]="{standalone: true}" 
                  (onSelect)="onItemSelect()"
                  (onSelectAll)="onSelectAll()"
                  (onDeSelect)="onItemDeSelect()"
                  (onDeSelectAll)="onUnSelectAll()">>
                </ng-multiselect-dropdown>
            </div>
          
            <!--div *ngIf="editForm" class="col-md-8 mb-3">
              <label for="validationDefault02">Listes des Equipes</label>
              <ng-multiselect-dropdown
                [settings]="dropdownSettings_equipe"
                [data]="equipes"
                [(ngModel)]="myLabo.equipes_object" [ngModelOptions]="{standalone: true}" 
                (onSelect)="onItemSelect()"
                (onSelectAll)="onSelectAll()"
                (onDeSelect)="onItemDeSelect()"
                (onDeSelectAll)="onUnSelectAll()">>
              </ng-multiselect-dropdown>
          </div-->
         
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"  (click)="resetLabo(labo_f)">Close</button>
              <button *ngIf="!editForm"  type="button" class="btn btn-success" data-bs-dismiss="modal"  (click)="addLabo(labo_f)" [disabled]="!acro_labo.valid || !intitule.valid || !responsable.valid && (responsable.touched || responsable.dirty)">Add Labo</button>
              <button *ngIf="editForm"   type="button" class="btn btn-warning" data-bs-dismiss="modal"  (click)="updateLabo(labo_f)" >edit Labo</button>
              
            </div>
            
          </form>
  
      </div>
    </div>
  </div>
</div>



<!-- ----------------------------------------------------------------Update Labo -->

<div class="modal fade" id="updateLabo" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">

        <h5  class="modal-title fw-bold">Modifier Labo</h5>

        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true"><i class="bi bi-x-lg"></i></span>
        </button>
      </div>
      <div class="modal-body">

        <form  #labo_fu="ngForm" ngNativeValidate >
       
          
          <div class="mb-3">
            <label class="form-label">Acronyme</label>
            <input [(ngModel)]="myLabo.acro_labo"  [ngModelOptions]="{standalone: true}"  ngModel #acro_labo1="ngModel" minlength="4" [appCheckExist]="[labos,'acro_labo1']" type="text" class="form-control" name="titre11" placeholder="Acronyme " required>
            <div class="invalid-feedback">
              <div   *ngIf="!acro_labo1.valid && (acro_labo1.touched || acro_labo1.dirty)">
                <div *ngIf="acro_labo1.errors?.['required']">this champ is required</div>
                <div *ngIf="acro_labo1.errors?.['minlength']">the minimum length should be {{acro_labo1.errors?.['minlength'].requiredLength}}</div>
              </div>
            </div>
          </div>

          <div class="mb-3">
              <label class="form-label">Intitulé</label>
              <input [(ngModel)]="myLabo.intitule" [ngModelOptions]="{standalone: true}"  type="text" class="form-control" name="titrew1" placeholder="Intitulé" required
              ngModel #intitule1="ngModel" minlength="4" [appCheckExist]="[labos,'intitule1']">
              <div class="invalid-feedback">
                <div  *ngIf="!intitule1.valid && (intitule1.touched || intitule1.dirty)">
                  <div *ngIf="intitule1.errors?.['required']">this champ is required</div>
                  <div *ngIf="intitule1.errors?.['minlength']">the minimum length should be {{intitule1.errors?.['minlength'].requiredLength}}</div>
                  <div *ngIf="intitule1.errors?.['forbiddenName']">
                    {{myLabo.intitule}} déja existe.
                  </div>
                </div>
              </div>
          </div>

          <div class="mb-3">
            <label for="responsableLabo" class="col-form-label">Responsable  </label>
            <select #responsableLabo1="ngModel" [(ngModel)]="myLabo.responsable" [ngModelOptions]="{standalone: true}"
                class="form-control" id="responsableLabo1" name="responsableLabo1"  required>
                <option class="p-1"  [ngValue]="prof" *ngFor="let prof of chercheurs">Pr {{prof.nom}} {{prof.prenom}}</option>
            </select>
          <div class="invalid-feedback">
             <div  *ngIf="responsableLabo1.valid && (responsableLabo1.touched || responsableLabo1.dirty)">
              <div *ngIf="responsableLabo1.errors?.['required']">this champ is required</div>
             
            </div>
          </div>
        </div>


          <div class="col-md-8 mb-3">
              <label for="validationDefault02">Listes des Axes</label>
              <ng-multiselect-dropdown
                [settings]="dropdownSettings_axe"
                [data]="axes"
                [(ngModel)]="myLabo.axes" [ngModelOptions]="{standalone: true}" 
                (onSelect)="onItemSelect()"
                (onSelectAll)="onSelectAll()"
                (onDeSelect)="onItemDeSelect()"
                (onDeSelectAll)="onUnSelectAll()">>
              </ng-multiselect-dropdown>
          </div>
       
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"  (click)="resetLabo(labo_f)">Close</button>
            <button  type="button" class="btn btn-warning" data-bs-dismiss="modal"  (click)="updateLabo(labo_f)" [disabled]="!acro_labo1.valid || !intitule1.valid || !responsableLabo1.valid && (responsableLabo1.touched || responsableLabo1.dirty)" >edit Labo</button>
            
          </div>
          
        </form>

    </div>
  </div>
</div>
</div>

<!-------------------------------------------------addAxe TO lABO----------------->
<div class="modal fade" id="ajouterEquipe" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">

        <h5 *ngIf="addEquipe" class="modal-title fw-bold">Ajouter Des Equipes a  {{myLabo.acro_labo}}</h5>
        <h5 *ngIf="addAxe"    class="modal-title fw-bold">Ajouter Des Axes a  {{myLabo.acro_labo}}</h5>

        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true"><i class="bi bi-x-lg"></i></span>
        </button>
      </div>
      <form  #labo_ff="ngForm"  >
      <div *ngIf="addAxe" class="modal-body">
        <label for="validationDefault02">Listes des Axes</label>
        <ng-multiselect-dropdown
          [settings]="dropdownSettings_axe"
          [data]="axes"
          [(ngModel)]="myLabo.axes" [ngModelOptions]="{standalone: true}" 
          (onSelect)="onItemSelect()"
          (onSelectAll)="onSelectAll()"
          (onDeSelect)="onItemDeSelect()"
          (onDeSelectAll)="onUnSelectAll()">>
        </ng-multiselect-dropdown>
    </div>
      <!--div class="modal-body">
        <div *ngIf="editForm" class="col-md-8 mb-3">
            <label for="validationDefault02">Listes des Equipes</label>
            <ng-multiselect-dropdown
              [settings]="dropdownSettings_equipe"
              [data]="equipes"
              [(ngModel)]="myLabo.equipes_object" [ngModelOptions]="{standalone: true}" 
              (onSelect)="onItemSelect()"
              (onSelectAll)="onSelectAll()"
              (onDeSelect)="onItemDeSelect()"
              (onDeSelectAll)="onUnSelectAll()">>
            </ng-multiselect-dropdown>
        </div-->
       
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"  (click)="resetLabo(labo_ff)">Close</button>
            <button type="button" class="btn btn-warning"   data-bs-dismiss="modal"  (click)="updateLabo(labo_ff)" >edit Labo</button>
            
          </div>
          
        </form>

    </div>
  </div>
</div>
